  <!DOCTYPE html> 
  <html>
  	<head>
	  	<meta name="viewport" content="width=device-width, initial-scale=1">
  		<title>GPIO Configuration</title>
  		<link rel="shortcut icon" href="/favicon">
  		<style>
			left-align {text-align: left;}
  		    meta {content:"width=device-width, initial-scale=1"}
  			html { font-family: Helvetica; display: inline-block; margin: 0px auto; text-align: left;}
  			body{margin-top: 50px;} h1 {color: #444444;margin: auto 30px;text-align: center;} h3 {color: #444444;margin-bottom: 20px;}
  			p {font-size: 14px;color: black;margin-bottom: 10px;}
			table {border: 1px solid black;border-collapse: collapse;}
			th, td {text-align: left;padding: 8px;}
			tr:nth-child(odd) {background-color: #D6EEEE;}
			td {border-bottom: 1px solid #444444;}
			.radio-group {display: grid; grid-template-columns: auto 1fr; gap: 10px;align-items: left;}
  		</style>

  		<script>
			var bit;

			async function init()
			{
				myUrl = new URL(window.location.toLocaleString()).searchParams;
				bit = myUrl.get('bitno');
				getConfig(bit);
				document.getElementById("header").innerText = "Configuration for GPIO BitNo: " +bit;
				showHelp(bit);
				const gpioTypes = document.querySelectorAll('input[name="type"]');
				gpioTypes.forEach(type => {
				type.addEventListener('change', typeChanged);});
			}

			async function typeChanged()
			{
      			const type = document.querySelector('input[name="type"]:checked');
				showHelp(type);
			}

			async function postit(url, content)
  			{
  			   const response = await fetch(url, 
			   {
    			      method: "POST",
    			         //body: JSON.stringify(content),
    			         body: content,
    			      headers: 
    			      	 {"Content-type": "application/json; charset=UTF-8"}
  			    });
			}
	  		
			async function postConfig(bit) 
			{
console.log("aa");
      			   const selectedType = document.querySelector('input[name="type"]:checked');
			   var name = document.getElementById('Name');
              		   var preset0 = document.getElementById('Preset0');
              		   var preset1 = document.getElementById('Preset1');
              		   var preset2 = document.getElementById('Preset2');
              		   var rate = document.getElementById('Rate');
console.log("x");
			   var easingType = document.getElementById('easingType');
console.log("y");
			   var enableRemote = document.getElementById('enableRemote');
			   var enableLocal = document.getElementById('enableLocal');
              		   var publishRate = document.getElementById('PublishRate');

  			   var url = "//"+window.location.host+"/api/gpio/config/bit";
              		   var out = '{"bitNo":' + bit + ',';
			   out = out + '"name":"' + name.value + '",';
              		   out = out + '"type":' + selectedType.value + ',';
              		   out = out + '"preset0":' + preset0.value + ',';
              		   out = out + '"preset1":' + preset1.value + ',';
              		   out = out + '"preset2":' + preset2.value + ',';
              		   out = out + '"rate":' + rate.value + ',';
console.log("a");
              		   out = out + '"easingType":' + easingType.value + ',';
console.log("b");
              		   out = out + '"enableRemote":' + enableRemote.checked + ',';
              		   out = out + '"enableLocal":' + enableLocal.checked + ',';
              		   out = out + '"publishRate":' + publishRate.value + '}';
console.log(out);
 			   postit(url,out);
			};

			async function getConfig(bit) 
			{
console.log("getConfig");
  			  var response = await fetch("//"+window.location.host+"/api/gpio/config/bit?bitno="+bit);
			  var data = await response.json();
			  var resp = JSON.parse(JSON.stringify(data));
			  ele = document.getElementById('Name');	
	  		  ele.value = resp.name;
			  var bitNo = resp.bitNo;
console.log("get type:" + resp.type);
			  var id = "type" + resp.type
              		  var ele = document.getElementById(id);	
	  		  ele.checked = true;
			  ele = document.getElementById('Preset0');	
	  		  ele.value = resp.preset0;
			  ele = document.getElementById('Preset1');	
	  		  ele.value = resp.preset1;
			  ele = document.getElementById('Preset2');	
	  		  ele.value = resp.preset2;
			  ele = document.getElementById('Rate');	
	  		  ele.value = resp.rate;
			  ele = document.getElementById('easingType');
			  ele.value = resp.easingType;
			  ele = document.getElementById('enableRemote');
			  
			  console.log(resp.enableRemote);

	  		  ele.checked = resp.enableRemote;
			  ele = document.getElementById('enableLocal');	
	  		  ele.checked = resp.enableLocal;
			  ele = document.getElementById('PublishRate');	
	  		  ele.value = resp.publishRate;
console.log("done");
			};

			function showHelp(type) 
			{
				for(var i=0;i<8;i++)
				{
					var ele1 = document.getElementById("type" + i + "1").style.display = 'none';
					var ele2 = document.getElementById("type" + i + "2").style.display = 'none';
					var ele3 = document.getElementById("type" + i + "3").style.display = 'none';
					var ele4 = document.getElementById("type" + i + "4").style.display = 'none';
					var ele5 = document.getElementById("type" + i + "5").style.display = 'none';
				}
				var ele6 = document.getElementById("ServoEasing").style.display = 'none';
				if(type.value == 0)ele0.style.visibility = 'visible';
				if(type.value == 1)ele1.style.display = 'block';
				if(type.value == 2)ele2.style.display = 'block';
				if(type.value == 3)ele3.style.display = 'block';
				if(type.value == 4)ele4.style.display = 'block';
				if(type.value == 5)ele5.style.display = 'block';
				if(type.value == 3)ele6.style.display = 'block';
			};

		</script>
  	</head>
	<body onload = "init()">
		<h1><p font-size: 30 px;text-align: "centre";color: #444444; id="header";></p>GPIO Configuration</h1>
  		<table width="100%";outline: 5px solid #1C6EA4;outline-offset: 0px;>
			<tr>
				<td width=30%">Name</td>
				<td width=30%"><input type="text" id="Name" name="Name" value="- Loading..."></td>
				<td width=40%">Friendly Name</td>
			</tr>
			<tr>
				<td width=30%">GPIO Type</td>
				<td width=30%">
    				<input type="radio" name= "type" Id="type0" value="0" 1/>None
    				<input type="radio" name= "type" Id="type1" value="1" 0/>PWM
    				<input type="radio" name= "type" Id="type2" value="2" 0/>DIGOUT
    				<input type="radio" name= "type" Id="type3" value="3" 0/>SERVO
    				<input type="radio" name= "type" Id="type4" value="4" 0/>DIGIN
    				<input type="radio" name= "type" Id="type5" value="5" 0/>AIN
    				<input type="radio" name= "type" Id="type6" value="6" 0/>DIGOUT_PULSE
    				<input type="radio" name= "type" Id="type7" value="7" 0/>PWM_PULSE
    			</td>
				<td width=40%">
					<span></span>
				</td></td>
			</tr>
			<tr>
				<td width=30%">Preset 0</td>
				<td width=30%"><input type="text" id="Preset0" name="Preset0" value="- Loading..."></td>
				<td width=40%">
					<span id="type01" >Free (can be read by Edge Action Software)</span>
					<span id="type11" >Not Used</span>
					<span id="type21" >Not Used</span>
					<span id="type31" >Angle preset 0-180 deg</span>
					<span id="type41" >Not Used</span>
					<span id="type51" >Not Used</span>
					<span id="type61" >Mark Period (mS)</span>
					<span id="type71" >Mark Period (mS)</span>
				</td>
			</tr>
			<tr>
				<td width=30%">Preset 1</td>
				<td width=30%"><input type="text" id="Preset1" name="Preset1" value="- Loading..."></td>
				<td width=40%">
				<span id="type02">Free (can be read by Edge Action Software)</span>
				<span id="type12">OFF PWM frequency (0-255)</span>
				<span id="type22">Not Used</span>
				<span id="type32">Angle preset 0-180 deg</span>
				<span id="type42">Not Used</span>
				<span id="type52">Not Used</span>
				<span id="type62">Not Used</span>
				<span id="type72">OFF PWM frequency (0-255)</span>
				</td>
			</tr>
			<tr>
				<td width=30%">Preset 2</td>
				<td width=30%"><input type="text" id="Preset2" name="Preset2" value="- Loading..."></td>
				<td width=40%">
					<span id="type03">Free (can be read by Edge Action Software)</span>
					<span id="type13">ON PWM frequency (0-255)</span>
					<span id="type23">Not Used</span>
					<span id="type33">Angle preset 0-180 deg</span>
					<span id="type43">Not Used</span>
					<span id="type53">Not Used</span>
					<span id="type63">Not Used</span>
					<span id="type73">ON PWM frequency (0-255)</span>				
				</td>
			</tr>
			<tr>
				<td width=30%">Rate</td>
				<td width=30%"><input type="text" id="Rate" name="Rate" value="- Loading..."></td>
				<td width=40%">
					<span id="type04">Free (can be read by Edge Action Software)</span>
					<span id="type14">Not Used</span>
					<span id="type24">Not Used</span>
					<span id="type34">Slew Rate (degrees per second)</span>
					<span id="type44">Input Polling Rate (mS)</span>
					<span id="type54">Input Polling Rate (mS)</span>
					<span id="type64">Cycle Period (mS)</span>
					<span id="type74">Cycle Period (mS)</span>				
				</td>
			</tr>
			<tr id="ServoEasing">
				<td width=30%">Easing Type</td>
				<td width=30%">
					<select id="easingType" name="easingType">
					<option value="0">EASE_LINEAR</option>
					<option value="1">EASE_QUADRATIC_IN</option>
					<option value="65">EASE_QUADRATIC_OUT</option>
					<option value="129">EASE_QUADRATIC_IN_OUT</option>
					<option value="193">EASE_QUADRATIC_BOUNCING</option>
					<option value="2">EASE_CUBIC_IN</option>
					<option value="66">EASE_CUBIC_OUT</option>
					<option value="130">EASE_CUBIC_IN_OUT</option>
					<option value="194">EASE_CUBIC_BOUNCING</option>
					<option value="3">EASE_QUARTIC_IN</option>
					<option value="67">EASE_QUARTIC_OUT</option>
					<option value="131">EASE_QUARTIC_IN_OUT</option>
					<option value="195">EASE_QUARTIC_BOUNCING</option>
					<option value="8">EASE_SINE_IN</option>
					<option value="72">EASE_SINE_OUT</option>
					<option value="136">EASE_SINE_IN_OUT</option>
					<option value="200">EASE_SINE_BOUNCING</option>
					<option value="9">EASE_CIRCULAR_IN</option>
					<option value="73">EASE_CIRCULAR_OUT</option>
					<option value="137">EASE_CIRCULAR_IN_OUT</option>
					<option value="201">EASE_CIRCULAR_BOUNCING</option>
					<option value="10">EASE_BACK_IN</option>
					<option value="74">EASE_BACK_OUT</option>
					<option value="138">EASE_BACK_IN_OUT</option>
					<option value="202">EASE_BACK_BOUNCING</option>
					<option value="11">EASE_ELASTIC_IN</option>
					<option value="75">EASE_ELASTIC_OUT</option>
					<option value="139">EASE_ELASTIC_IN_OUT</option>
					<option value="203">EASE_ELASTIC_BOUNCING</option>
					<option value="76">EASE_BOUNCE_IN</option>
					<option value="12">EASE_BOUNCE_OUT</option>
					<option value="13">EASE_PRECISION_IN</option>
					<option value="77">EASE_PRECISION_OUT</option>
				</select></td>
				<td width=40%">
					<span id="type05" style="display:none">Not Used</span>
					<span id="type15" style="display:none">Not Used</span>
					<span id="type25" style="display:none">Not Used</span>
					<span id="type35" style="display:none">Not Used</span>
					<span id="type45" style="display:none">Not Used</span>
					<span id="type55" style="display:none">Not Used</span>
					<span id="type65" style="display:none">Not Used</span>
					<span id="type75" style="display:none">Not Used</span>
				</td>
			</tr>
			<tr>
				<td width=30%">
  		    		Enable Remote Control</td>
				<td width=30%"><input type="checkbox" id="enableRemote" value="Option1"></td>
				<td width=40%">
					<span>Respond to demands via MQTT</span>
				</td>
			</tr>
			<tr>
				<td width=30%">
  		    		Enable Local Control</td>
				<td width=30%"><input type="checkbox" id="enableLocal" value="Option1"></td>
				<td width=40%">
					<span>Respond to local (edge software) demands</span>
				</td>
			</tr>
			<tr>
				<td width=30%">
  		    			Publish Rate</td>
				<td width=30%"><input type="text" id="PublishRate" name="PublishRate" value="- Loading..."></td>
				<td width=40%">
					<span id="type08">Not Used</span>
					<span id="type18">Background Publish Rate (mS)</span>
					<span id="type28">Background Publish Rate (mS)</span>
					<span id="type38">Background Publish Rate (mS)</span>
					<span id="type48">Background Publish Rate (mS)</span>
					<span id="type58">Background Publish Rate (mS)</span>
					<span id="type68">Background Publish Rate (mS)</span>
					<span id="type78">Background Publish Rate (mS)</span>
				</td>
			</tr>
			</table>
			</br><br>
			
 	        <button type="button" style="height:60px;width:200px;font-size:20px" onclick="postConfig(bit)">Save</button><br><br>

			</br></br>
			<table width="100%";outline: 5px solid #1C6EA4;outline-offset: 0px;>
			<tr>
				<td style="width:25%"><a href='/page/node'>node</a></td>
				<td style="width:25%"><a href='/page/gpio'>gpio</a></td>
				<td style="width:25%"><a href='/page/action'>action</a></td>
				<td style="width:25%"><a href='/page/sound'>sound</a></td>
			</tr>
		</table>
  	</body>
  </html>
  
  
  
  
  
  
